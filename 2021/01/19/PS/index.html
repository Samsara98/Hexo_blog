<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>PS | SamsarA</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/mermaid/8.8.2/mermaid.min.js"></script><script>mermaid.initialize({
  startOnLoad: true
  , theme: 'dark'
});</script><link rel="stylesheet" href="/samsara/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/samsara/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/samsara/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/samsara/atom.xml" title="SamsarA" type="application/atom+xml">
</head><body><header><nav><a href="/samsara/">Home</a><a href="/samsara/archives/">Archives</a></nav></header><main><article><div id="post-bg"><div id="post-title"><h1>PS</h1><hr></div><div id="post-content"><p>Welcome to <a href="https://samsara98.gitee.io/samsara/">SamsarA’s Blog</a>! If you get any problems when reading my blog, you can<br>ask me on <a target="_blank" rel="noopener" href="https://gitee.com/samsara98/samsara">Gitee</a>.</p>
<h1 id="My-PS"><a href="#My-PS" class="headerlink" title="My PS"></a>My PS</h1><pre><code>#数组 #图像算法</code></pre>
<p>&nbsp; You can get source code on my <a target="_blank" rel="noopener" href="https://gitee.com/samsara98/ps">Gitee</a>.</p>
<p><em>FEATHER</em></p>
<ul>
<li>马赛克滤镜</li>
<li>毛玻璃滤镜</li>
<li>增大图像饱和度</li>
<li>增大图像对比度</li>
<li>图像色调调整</li>
<li>生成灰度图</li>
<li>压缩图像</li>
<li>放大图像</li>
<li>橡皮擦</li>
<li>使用Face++的API，添加美颜以及滤镜功能。</li>
</ul>
<h2 id="图像处理算法"><a href="#图像处理算法" class="headerlink" title="图像处理算法"></a>图像处理算法</h2><hr>
<h3 id="马赛克-毛玻璃"><a href="#马赛克-毛玻璃" class="headerlink" title="马赛克/毛玻璃"></a>马赛克/毛玻璃</h3><p><em>马赛克：选取半径内的像素点，随机选取一个来替换整个半径内的像素点</em><br><em>毛玻璃：选取半径内的像素点，随机选取一个来替换单个像素点</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">private int[][] mosaicPixel(int[][] pixelArrary, int x, int y, int RADIUS) &#123;  //xy为选取点，RADIUS为马赛克半径<br>    ...<br>    ...<br>&#125;<br><br>private int[][] groundGlassPixel(int[][] pixelArrary, int x, int y， int RADIUS) &#123;  //xy为选取点，RADIUS为毛玻璃半径<br>    ...<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="压缩-放大"><a href="#压缩-放大" class="headerlink" title="压缩/放大"></a>压缩/放大</h3><p><em>压缩算法：根据压缩倍数每隔若干像素点进行取点，复制到新图像中</em><br><em>放大算法：根据放大倍数对像素点进行取点后插空放置到新图像中，使用卷积算法补充像素点</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">public GImage zip(GImage <span class="hljs-built_in">source</span>) &#123;   // 压缩算法    <br>    ...<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">public GImage extend(GImage <span class="hljs-built_in">source</span>) &#123;   // 放大算法<br>    ...<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="灰度图"><a href="#灰度图" class="headerlink" title="灰度图"></a>灰度图</h3><p><em>灰度图算法：计算出像素点的亮度，调整rgb为亮度值，保留图像亮度，图像显示为不同程度的灰色</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">public GImage grey(GImage <span class="hljs-built_in">source</span>) &#123;   //灰度图算法<br>    ...<br>    pixelArrary[newy][newx] = GImage.createRGBPixel(luminosity, luminosity, luminosity);<br><br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="饱和度增加"><a href="#饱和度增加" class="headerlink" title="饱和度增加"></a>饱和度增加</h3><p><em>饱和度算法：计算像素点的rgb平均值，增大rgb和平均值的偏移，使得图像饱和度增大</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">public GImage saturationEnhancement(GImage <span class="hljs-built_in">source</span>) &#123;   //饱和度增强算法<br>    ...<br>    rgb[i] += (rgb[i] - aver) * SATURATION;  //averrgb平均值，SATURATION偏移率<br>    rgb[i] = (rgb[i] &lt; 0) ? 0 : rgb[i];<br>    rgb[i] = (rgb[i] &gt; 255) ? 255 : rgb[i];<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="对比度增加"><a href="#对比度增加" class="headerlink" title="对比度增加"></a>对比度增加</h3><p><em>对比度算法：计算像素点的亮度平均值，增大每个点rgb和亮度平均值的偏移，使得图像对比度增大</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">public GImage contrastEnhancement(GImage <span class="hljs-built_in">source</span>) &#123;   //对比度增强算法<br>...<br>...<br><span class="hljs-keyword">for</span> (int y_ = 0; y_ &lt; Height; y_++) &#123;  //根据每个像素亮度在pixelLuminosity的位置，计算均衡化的亮度<br>    <span class="hljs-keyword">for</span> (int x_ = 0; x_ &lt; Width; x_++) &#123;<br>        int Luminosity = getLuminosity(pixelArray[y_][x_]);<br>        int r = GImage.getRed(pixelArray[y_][x_]);<br>        int g = GImage.getGreen(pixelArray[y_][x_]);<br>        int b = GImage.getBlue(pixelArray[y_][x_]);<br>        r += (Luminosity - averLu) * 0.6; //averLU亮度平均值<br>        g += (Luminosity - averLu) * 0.6;<br>        b += (Luminosity - averLu) * 0.6;<br>...<br>...<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h3 id="边界描绘"><a href="#边界描绘" class="headerlink" title="边界描绘"></a>边界描绘</h3><p><em>算法：计算半径内较该点明亮和暗黑的像素点的比例，在范围内判定为边界</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">public GImage layOut(GImage <span class="hljs-built_in">source</span>) &#123;  //描绘边界<br>    ...<br>    ...<br>    int RADIUS = 3;  //检测半径<br>    <span class="hljs-keyword">for</span> (int y = 0; y &lt; Height; y +=  1) &#123;<br>        <span class="hljs-keyword">for</span> (int x = 0; x &lt; Width; x += 1) &#123;<br><br>            int MAX_x = Math.min(Width-1, x + RADIUS);  //选择检测的范围<br>            int MAX_y = Math.min(Height-1, y + RADIUS);<br>            int MIN_x = Math.max(0, x - RADIUS);<br>            int MIN_y = Math.max(0, y - RADIUS);<br><br>            int bigger = 0;<br>            int smaller = 0;<br>            int luminosity = getLuminosity(pixelArrary[y][x]);<br>            int r = GImage.getRed(pixelArrary[y][x]);<br>            int g = GImage.getGreen(pixelArrary[y][x]);<br>            int b = GImage.getBlue(pixelArrary[y][x]);<br><br>            <span class="hljs-keyword">for</span> (int y_ = MIN_y; y_ &lt;= MAX_y; y_++) &#123;  //计算半径内较暗较亮像素点个数<br>                <span class="hljs-keyword">for</span> (int x_ = MIN_x; x_ &lt;= MAX_x; x_++) &#123;<br>                    int luminosity_ = getLuminosity(pixelArrary[y_][x_]);<br>                    <span class="hljs-keyword">if</span> (luminosity &gt;= luminosity_) &#123;<br>                        smaller += 1;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        bigger += 1;  <br>                    &#125;<br>                &#125;<br>            &#125;<br>            double radio = (double) bigger / (smaller - 1);  //半径内明暗比例<br>            <span class="hljs-keyword">if</span> (radio &gt;= 0.7 &amp;&amp; radio &lt;= 1.3) &#123;<br>                newPixelArrary[y][x] = GImage.createRGBPixel(0,0,0);  //边界像素<br>            &#125;<br>        ...<br>        ...<br>&#125;<br></code></pre></td></tr></table></figure>
<hr>
<h2 id="FACE-beautify-API"><a href="#FACE-beautify-API" class="headerlink" title="FACE++ beautify API"></a>FACE++ beautify API</h2><p><em>通过POST方法调用webAPI，通过“multipart/form-data;”方法传入字段来调节美白、磨皮、瘦脸、大眼、去眉、滤镜功能。并以byte数组形式传入图片文件</em><br><em>返回bash64编码的二进制图像文件</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">public String beautify(File currentfile, int whitening,int smoothing,int thinface,<br>int shrink_face,int enlarge_eye, int remove_eyebrow,String filterType) throws Exception&#123;<br>        File file = currentfile;<br>        byte[] buff = getBytesFromFile(file);<br>        String url = <span class="hljs-string">&quot;https://api-cn.faceplusplus.com/facepp/v2/beautify&quot;</span>;<br>        HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;();<br>        HashMap&lt;String, byte[]&gt; byteMap = new HashMap&lt;&gt;();<br>        ...<br>        ...<br>        map.put(<span class="hljs-string">&quot;whitening&quot;</span>, Integer.toString(whitening));<br>        map.put(<span class="hljs-string">&quot;smoothing&quot;</span>, Integer.toString(smoothing));<br>        map.put(<span class="hljs-string">&quot;thinface&quot;</span>, Integer.toString(thinface));<br>        map.put(<span class="hljs-string">&quot;shrink_face&quot;</span>, Integer.toString(shrink_face));<br>        map.put(<span class="hljs-string">&quot;enlarge_eye&quot;</span>, Integer.toString(enlarge_eye));<br>        map.put(<span class="hljs-string">&quot;remove_eyebrow&quot;</span>, Integer.toString(remove_eyebrow));<br>        map.put(<span class="hljs-string">&quot;filter_type&quot;</span>,filterType);<br>        ...<br>        ...<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">public GImage beautify(File currentfile, int whitening, int smoothing,int thinface, //文件，美颜参数：美白、磨皮、瘦脸（[0,100]）。<br>                        int shrink_face,int enlarge_eye, int remove_eyebrow, String filterType) &#123;    //缩脸、大眼、去眉（[0,100]）、滤镜（根据选择）<br>    FacePlus facePlus = new FacePlus();<br>    try &#123;<br>        String str = facePlus.beautify(currentfile, whitening, smoothing,thinface,shrink_face,enlarge_eye,remove_eyebrow, filterType);<br>        int index = str.indexOf(<span class="hljs-string">&quot;result\&quot;:\&quot;&quot;</span>);  //返回未String形式的字段map，截取其中result图像内容<br>        String str2 = str.substring(index + 9);<br>        str = str2.substring(0, str2.length() - 3);<br>        byte[] decoded = bash64.getDecoder().decode(str);  //解码bash64为二进制数组<br>        <span class="hljs-keyword">for</span> (int i = 0; i &lt; decoded.length; i++) &#123;  //转换为图像数组<br>            <span class="hljs-keyword">if</span> (decoded[i] &lt; 0) &#123;<br>                decoded[i] += 256;<br>            &#125;<br>        &#125;<br>        OutputStream out = new FileOutputStream(TMPFILE);   //TMPFILE：生成图像临时保存地址<br>        out.write(decoded);<br>        out.flush();<br>        out.close();<br>        <span class="hljs-built_in">return</span> new GImage(TMPFILE);<br>    &#125; catch (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-built_in">return</span> null;<br>&#125;<br></code></pre></td></tr></table></figure><div id="paginator"></div></div><div id="post-footer"><hr><a href="/samsara/2021/01/29/ZORK/">← Prev ZORK</a><span style="color: #fe2"> | </span><a href="/samsara/2021/01/13/Arkanoid/">Arkanoid Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: ''
 , appKey: ''
 , placeholder: '此条评论委托企鹅物流发送'
})</script></div></article><aside><div id="about"><a href="/samsara/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.SamsarA</a></h1><section id="total"><a id="total-archives" href="/samsara/archives"><span class="total-title">Archives Total:</span><span class="total-number">13</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">1</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">1</span></div></section></div><div id="aside-block" style="order: 0"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#My-PS"><span class="toc-number">1.</span> <span class="toc-text">My PS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%AE%97%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">图像处理算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%AC%E8%B5%9B%E5%85%8B-%E6%AF%9B%E7%8E%BB%E7%92%83"><span class="toc-number">1.1.1.</span> <span class="toc-text">马赛克&#x2F;毛玻璃</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9-%E6%94%BE%E5%A4%A7"><span class="toc-number">1.1.2.</span> <span class="toc-text">压缩&#x2F;放大</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%81%B0%E5%BA%A6%E5%9B%BE"><span class="toc-number">1.1.3.</span> <span class="toc-text">灰度图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A5%B1%E5%92%8C%E5%BA%A6%E5%A2%9E%E5%8A%A0"><span class="toc-number">1.1.4.</span> <span class="toc-text">饱和度增加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94%E5%BA%A6%E5%A2%9E%E5%8A%A0"><span class="toc-number">1.1.5.</span> <span class="toc-text">对比度增加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%B9%E7%95%8C%E6%8F%8F%E7%BB%98"><span class="toc-number">1.1.6.</span> <span class="toc-text">边界描绘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FACE-beautify-API"><span class="toc-number">1.2.</span> <span class="toc-text">FACE++ beautify API</span></a></li></ol></li></ol></div></div><footer><nobr><span class="text-title">©</span><span class="text-content">1998 to 2021</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——SAS——</span></nobr><wbr><wbr><nobr>published with&nbsp;<a target="_blank" rel="noopener" href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/samsara/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>